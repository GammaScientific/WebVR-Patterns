<html>
    <head>
        <link href="../style.css" rel="stylesheet">
        <script src="../lib/jquery-3.6.0.min.js" type="text/javascript"> </script>
        <script src="../lib/aframe.min.js" type="text/javascript"></script>
        <script>

          </script>
    </head>

    <body>
        <a-scene>
            <a-camera>
                <a-image position="0 0 -1" visible="false"></a-image>
                <a-plane position="0 0 -1" visible="true" color="white"><a-text value="Your image here.\n\n Be aware that image size and aspect ratio might hinder display. \n\n After uploading, press the VR button to display your image fullscreen." align="center" color="black" width="1" height="1" position="0 0 0"></a-text></a-plane>
                <script>
                        function recenter(){
                            const plane = document.querySelector("a-image");
                            const cam = document.querySelector("a-camera");
                            const height = plane.getAttribute("geometry").height;
                            const width = plane.getAttribute("geometry").width;
                            const distance = cam.object3D.position.distanceTo(plane.object3D.position);
                            var newDistance = 0;
                            if (width > height) {
                                const fov = cam.sceneEl.camera.fov * (Math.PI / 180);
                               newDistance = Math.abs((width / 2) / Math.tan(fov / 2));
                            } else {
                                const fov = cam.sceneEl.camera.fov * (Math.PI / 180);
                                newDistance = Math.abs((height / 2) / Math.tan(fov / 2));
                            }
                            cam.sceneEl.camera.zoom = (distance / newDistance)-0.18;
                            console.log("done");
                        }
                </script>
            </a-camera>
        </a-scene>

        <div id="info">
            <!-- Text input to determine size of each step -->
            <p>Upload your image here: <input type="file" id="image-input" accept="image/jpeg, image/png, image/jpg">
            <script>
                
                var uploaded_image;
                const plane = document.querySelector("a-image");
                const image_input = document.querySelector("#image-input");
                const camera1 = document.querySelector("a-camera");
                camera1.sceneEl.camera.zoom = 1;
                camera1.sceneEl.camera.fov = 80;
                image_input.addEventListener("change", function() {
                    document.querySelector("a-plane").setAttribute("visible","false");
                    const reader = new FileReader();
                    reader.addEventListener("load", () => {
                        uploaded_image = reader.result;
                    });
                    reader.readAsDataURL(this.files[0]);
                    reader.onload = function (e) {
                        //Initiate the JavaScript Image object.
                        var image = new Image();
    
                        //Set the Base64 string return from FileReader as source.
                        image.src = e.target.result;
                        
                        //Validate the File Height and Width.
                        image.onload = function () {
                            var height = this.height;
                            var width = this.width;
                            plane.setAttribute("src",`url(${uploaded_image})`);
                            plane.setAttribute("width",1);
                            plane.setAttribute("height",1/(width/height));
                            plane.setAttribute("visible","true");
                            recenter();
                        };
                    }
                });
            </script>
            </div></p>
        </div>

    </body>

</html>