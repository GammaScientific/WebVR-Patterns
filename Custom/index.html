<html>
    <head>
        <link href="../style.css" rel="stylesheet">
        <script src="../lib/jquery-3.6.0.min.js" type="text/javascript"> </script>
        <script src="../lib/aframe.min.js" type="text/javascript"></script>
        <link rel="stylesheet" href="../lib/jquery.minicolors.css">
        <script src="../lib/jquery.minicolors.min.js" type="text/javascript"> </script>
        <script src="./ControllerComponents.js" type="text/javascript"></script>
        <script>
        /* Code to register the orthographic camera as parent camera and remove original camera */
        AFRAME.registerComponent('ortho', {
            init: function () {
                /* Save original camera */
                var sceneEl = this.el.sceneEl;
                this.originalCamera = sceneEl.camera;
                this.cameraParent = sceneEl.camera.parent;
                /* Create orthographic camera using three.js */
                this.orthoCamera = new THREE.OrthographicCamera(-500, 500, 250, -250,.01, 2000);
                /* Makes this the parent camera and add it to scene */
                this.cameraParent.add(this.orthoCamera);
                sceneEl.camera = this.orthoCamera;
            },
            /* Removes orthographic camera and replaces it with original camera upon termination */
            remove: function () {
            this.cameraParent.remove(this.orthoCamera);
            sceneEl.camera = this.originalCamera;
            }
        });

        AFRAME.registerComponent('raycasterortho', {
            init: function () {
                /* Save original camera */
                var sceneEl = this.el.sceneEl;
                this.originalraycaster = sceneEl.components.raycaster;
                /* Create orthographic camera using three.js */
                this.raycaster = new THREE.Raycaster();
                raycaster.linePrecision = 0.1;
                /* Makes this the parent camera and add it to scene */
                this.cameraParent.add(this.orthoCamera);
                sceneEl.camera = this.orthoCamera;
            },
            /* Removes orthographic camera and replaces it with original camera upon termination */
            remove: function () {
            this.cameraParent.remove(this.orthoCamera);
            sceneEl.camera = this.originalCamera;
            }
        });
            AFRAME.registerComponent('thumbstick-logging-right',{
            init: function () {
                this.el.addEventListener('thumbstickmoved', this.logThumbstickRight);
            },
            logThumbstickRight: function (evt) {
                /* calls movement function with key that corresponds */
                if (evt.detail.y > 0.95) {zoomCam(-.001)}
                if (evt.detail.y < -0.95) {zoomCam(.001)}
            }
        });

        AFRAME.registerComponent('button-listener', {
            init: function () {
                var el = this.el;

                el.addEventListener('gripdown', function (evt) {
                    document.querySelector('a-scene').exitVR();
                });
            }
        });

        AFRAME.registerComponent("click-checker", {
            init: function() {
                this.el.addEventListener("click", (e)=>{
                    console.log(this.el);
                    selectNew(this.el);
                    });
                }
            });

        AFRAME.registerComponent('fill', {
            schema: {
                val: {type: 'float', default: 100},
                isFull: {type: "boolean", default: true}
            },
        });
        AFRAME.registerComponent('angle', {
            schema: {
                x: {type: 'float', default: 50},
                z: {type: 'float', default: 50}
            },
        });
        AFRAME.registerComponent('advanced', {
            schema: {
                val: {type: 'boolean', default: false}
            },
        });
        AFRAME.registerComponent('color2', {
            schema: {
                val: {type: 'string', default: "#000000"}
            },
        });
        </script>
    </head>

    <body>
        <a-scene>
            <a-entity raycaster cursor="rayOrigin: mouse" position="0 0 0" ></a-entity>
            <a-assets>
                <img id="QC" src="textures/TG18-QC.2k_12b.png">
                <img id="CH" src="textures/TG18-CH.2k.png">
                <img id="MM1" src="textures/TG18-MM1.2k.png">
                <img id="MM2" src="textures/TG18-MM2.2k.png">
                <img id="sQC" src="textures/TG270sQC.png">
                <img id="PQC" src="textures/TG18-PQC.2k_12b.png">
                <img id="BR" src="textures/TG18-BR.2k_12b.png">
                <img id="transparent" src="textures/transparent.jpg">
            </a-assets>
            <a-entity id="con-left" laser-controls="hand: left" model="true" button-listener-l thumbstick-left trackpad-left position-updates-left></a-entity>
            <a-entity id="con-right" laser-controls="hand: right" model="true" button-listener-r thumbstick-right trackpad-right position-updates-right></a-entity>
            <a-camera>
                <a-sky id="sky" color="#000000" radius="1000"></a-sky>
                <a-entity id="entityCanvas" visible="true"></a-entity>
            </a-camera>
        </a-scene>
       
        <div id="info">
            <button type="button" class="collapsible" id="collapse">Hide Settings</button>
            <div id="content">
                <p style="text-align:center;">Display Patterns              <input type="checkbox" id="displayUtility"
                    class="checkbox" onclick="toggleDisplayEdit(true)"/>
                    <label for="displayUtility" class="toggle"> </label>                  Edit Patterns</p>
                <div id="displayEditContent">
                    <p id="patternDisp"><b>Pattern Display:</b>
                        <p style="text-align:center;"><select class="select" name="patternDisplay" id="patternDisplay" onchange="displayCurrentPattern(this)">
                            <option value="default">default</option>
        
                            </select></p></p>

                    <p><b>Pattern List: </b></p>
                    <div id="patternList" class="scrollable">                <!--<select class="select" name="pattern" id="pattern" onchange="handlePatternSelect(this)" multiple>
                            <option value="default">default</option>
                            <option value="red">red</option>
                            <option value="green">green</option>
                            <option value="blue">blue</option>
                            <option value="white">white</option>
                            <option value="grille">grille</option>
                        </select>-->
                        <p>
                            <input type="checkbox" id="default"
                            onclick="handlePatternSelect(this)" checked/>
                            <label for="default"> default</label>
                        </p>
                        <p>
                            <input type="checkbox" id="red"
                            onclick="handlePatternSelect(this)"/>
                            <label for="red"> red</label>
                        </p>
                        <p>
                            <input type="checkbox" id="green"
                            onclick="handlePatternSelect(this)"/>
                            <label for="green"> green</label>
                        </p>
                        <p>
                            <input type="checkbox" id="blue"
                            onclick="handlePatternSelect(this)"/>
                            <label for="blue"> blue</label>
                        </p>
                        <p>
                            <input type="checkbox" id="white"
                            onclick="handlePatternSelect(this)"/>
                            <label for="white"> white</label>
                        </p>
    
                        <p>
                            <input type="checkbox" id="grille"
                            onclick="handlePatternSelect(this)"/>
                            <label for="grille"> grille</label>
                        </p>
                         
                        <p>
                            <input type="checkbox" id="crosshair"
                            onclick="handlePatternSelect(this)"/>
                            <label for="crosshair"> crosshair</label>
                        </p>
                        
                        <p>
                            <input type="checkbox" id="line"
                            onclick="handlePatternSelect(this)"/>
                            <label for="line"> line</label>
                        </p>
                        
                        <p>
                            <input type="checkbox" id="dot array"
                            onclick="handlePatternSelect(this)"/>
                            <label for="dot array"> dot array</label>
                        </p>
                        
                        <p>
                            <input type="checkbox" id="checkerboard (w)"
                            onclick="handlePatternSelect(this)"/>
                            <label for="checkerboard (w)"> checkerboard (w)</label>
                        </p>
                        
                        <p>
                            <input type="checkbox" id="checkerboard (b)"
                            onclick="handlePatternSelect(this)"/>
                            <label for="checkerboard (b)"> checkerboard (b)</label>
                        </p>

                        </div>
                <p id="addPattern">
                <b>Name: </b><input type="text" class="input" id="name" value="name"></p>
                    <p style="text-align:center;" id="renamePatternButton">
                        <button style="text-align:center;" class="button add" onclick="renamePattern()">Rename Pattern</button>
                    </p>
                    <p style="text-align:center;" id="addPatternButton">
                        <button style="text-align:center;" class="button add" onclick="addPattern()">Add Pattern</button>
                    </p>
                    <p style="text-align:center;" id="removePatternButton">
                        <button style="text-align:center;" class="button reset" onclick="removePattern()">Remove Pattern</button>
                    </p>
                <p style="text-align:center;" id="uploadDisp">
                        <b>Upload patterns:            </b><input type="file" id="scene-disp-input" accept=".json" multiple>
                    </p>

                        
                <p style="text-align:center;" id="saveSelectedPatterns">
                    <button style="text-align:center;" class="button add" onclick="saveSelected()">Save Selected Patterns</button>
                </p>
            </div>
                <div id="addEditContent">

                    <p style="text-align:center;">Add Entity              <input type="checkbox" id="utility"
                        class="checkbox" onclick="toggleAddEdit(true)"/>
                        <label for="utility" class="toggle"> </label>                  Edit Entity</p>
                        

                    <p id="addChoice" style="text-align:center;"><b>Type of entity:</b>
                        <select class="select" name="entity" id="entity">
                            <option value="circle">circle</option>
                            <option value="plane">plane</option>
                            <option value="triangle">triangle</option>
                            <option value="gradient">gradient</option>
                            <option value="checkerboard">checkerboard</option>
                            <option value="grille">grille</option>
                            <option value="dotarray">dot array</option>
                            
                        </select>
                    </p>
                    <p style="text-align:center;" id="addButton">
                        <button class="button add" onclick="addEntity()">Add to Pattern</button>
                    </p>
                    <p id="backgroundSettings"><b>Background Settings</b></p>
                    <div id="skyIn" position="absolute" width="45%" left="0">Sky Color: <input type="text" class="input" id="skyCol" value="#000000"></div>
                    <p>

                    <p id="entitySettings" style="text-align:left;"><b>Entity Settings</b>
                                               
                            <span style="float:right;">
                                <label for="advanced" style="float:left;margin-right:15px"> Advanced</label>
                                <input type="checkbox" id="advanced"
                                onclick="switchToAdvanced(true)"/>
                            </span>



                    </p>

                    

                    
                    <p id="editSelector">Current entity: <select name="entityId" id="entityId"  onchange="selectNew(null)">
                    </select></p>
                    <p style="text-align:center;" id="removeButton">
                        <button class="button reset" onclick="removeEntity()">Remove from Pattern</button></p>
                    <p style="text-align:center;" id="duplicateButton">
                        <button class="button add" onclick="duplicateEntity()">Duplicate Entity</button></p>
                    <p id="universalSettings"><b>Universal Entity Settings</b></p>
                    <p id="posIn">Position: (&alpha;: deg, y: m, r: distance m)<input type="text" class="input" id="z" value="0"> <input type="text" class="input" id="y" value="0"> <input type="text" class="input" id="x" value="0"></p>
                    <p id="rotIn">Rotation (deg):  <input type="text" class="input" id="rotationZ" value="0"><input type="text" class="input" id="rotationY" value="0"><input type="text" class="input" id="rotationX" value="0"></p>
                    <div id="colIn" position="absolute" width="75%" left="0">Primary Color: <input type="text" class="input" id="color" value="#FFFFFF"></div>
                    <div id="colIn2" position="absolute" width="75%" left="0">Secondary Color: <input type="text" class="input" id="color2" value="#FFFFFF"></div>
                    <p id="nonUniversalSettings"><b>Entity Specific Settings</b></p>
                    <p id="textureIn">Texture:                 <select class="select" name="texture" id="texture">
                        <option value="none">none</option>
                        <option value="QC">TG18-QC.2k_12b</option>
                        <option value="CH">TG18-CH.2k</option>
                        <option value="MM1">TG18-MM1.2k</option>
                        <option value="MM2">TG18-MM2.2k</option>
                        <option value="sQC">TG270sQC</option>
                        <option value="PQC">TG18-PQC.2k_12b</option>
                        <option value="BR">TG18-BR.2k_12b</option>
                        <!-- Transparent textures don't work
                            <option value="transparent">transparent</option>-->
                    </select></p>
                    <p style="text-align:center;" id="uploadTextureIn">
                        Upload your textures here: <input type="file" id="texture-input" accept="image/png, image/jpeg, image/tiff, image/" multiple>
                    </p>
                    <p id="heightIn">Bar Height (m): <input type="text" class="input" id="height" value=".25"></p>
                    <p id="widthIn">Bar Width (m): <input type="text" class="input" id="width" value=".125"></p>
                    <p id="radiusIn">Radius (m): <input type="text" class="input" id="radius" value=".125"></p>
                    <p id="fillIn">Border Size (m): <input type="text" class="input" id="fill" value=".25"></p>
                    <p id="va">Vertex A: (x: m, y: m)<input type="text" class="input" id="vay" value="0.1875"> <input type="text" class="input" id="vax" value="0"></p>
                    <p id="vb">Vertex B: (x: m, y: m)<input type="text" class="input" id="vby" value="-0.25"> <input type="text" class="input" id="vbx" value="-0.25"></p>
                    <p id="vc">Vertex C: (x: m, y: m)<input type="text" class="input" id="vcy" value="-0.25"> <input type="text" class="input" id="vcx" value="0.25"></p>
                    <p id="numBars">Number of bars: <input type="text" class="input" id="numBarsIn" value="32"></p>
                    <p id="tileSize">Width/Height of square: <input type="text" class="input" id="tileSizeIn" value=".1"></p>
                    <p id="circleSize">Radius of circles: <input type="text" class="input" id="circleSizeIn" value=".1"></p>
                    <p id="spacing">Spacing of circles: <input type="text" class="input" id="spacingIn" value=".1"></p>
                    <p id="rows">Number of rows: <input type="text" class="input" id="rowsIn" value="16"></p>
                    <p id="cols">Number of columns: <input type="text" class="input" id="colsIn" value="16"></p>

                    
                    <!--<p style="text-align:center;" id="sendButton">
                        <button class="button add" onclick="sendBack(true)">Send back</button><button class="button add" onclick="sendBack(false)">Send forward</button>
                    </p>-->
                    <p style="text-align:center;" id="upload">
                        <b>Upload a pattern: </b><input type="file" id="scene-input" accept=".json">
                    </p>

                    <form id="reset" style="text-align:center;">
                        <button type="button" class="button reset" onclick="resetScene()">Reset Pattern</button>
                    </form>
                    <p style="text-align:center;" id="saveButton">
                        <button class="button add" onclick="saveScene()">Save Pattern</button>
                    </p>
                </div>
            </div>
        </div>
        <div id="directions">
        <button type="button" class="collapsible" id="directionsCollapse" onclick="window.open('https://github.com/brendanc490/WebVR-Test-Patterns/blob/main/Custom/README.md','_blank')">Directions</button>

        </div>
        <script src="script.js" type="text/javascript"></script>
        <script src="graphicInterface.js" type="text/javascript"></script>
        <script src="utility.js" type="text/javascript"></script>
        <script src="changeListeners.js" type="text/javascript"></script>
        <script src="drawing.js" type="text/javascript"></script>
        <script src="editing.js" type="text/javascript"></script>
        <script src="saving.js" type="text/javascript"></script>
        <script src="uploading.js" type="text/javascript"></script>
        <script src="load.js" type="module"></script>
        <script src="ControllerInputMapping.js" type="module"></script>
        
    </body>

</html>